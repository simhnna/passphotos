!function(){"use strict";var e="undefined"!=typeof document?document.currentScript:null;function t(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function c(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}u((r=r.apply(e,t||[])).next())}))}function n(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(c){return function(u){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,u])}}}let r;"function"==typeof SuppressedError&&SuppressedError;const o="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};"undefined"!=typeof TextDecoder&&o.decode();let a=null;function i(){return null!==a&&0!==a.byteLength||(a=new Uint8Array(r.memory.buffer)),a}function c(e,t){return e>>>=0,o.decode(i().subarray(e,e+t))}const u=new Array(128).fill(void 0);u.push(void 0,null,!0,!1);let s=u.length;function l(e){s===u.length&&u.push(u.length+1);const t=s;return s=u[t],u[t]=e,t}function d(e){return u[e]}function f(e){const t=d(e);return function(e){e<132||(u[e]=s,s=e)}(e),t}let p=0;let g=null;function h(){return null!==g&&0!==g.byteLength||(g=new Int32Array(r.memory.buffer)),g}function m(e){try{const s=r.__wbindgen_add_to_stack_pointer(-16),l=function(e,t){const n=t(1*e.length,1)>>>0;return i().set(e,n/1),p=e.length,n}(e,r.__wbindgen_malloc),d=p;r.gen(s,l,d);var t=h()[s/4+0],n=h()[s/4+1],o=h()[s/4+2];if(h()[s/4+3])throw f(o);var a=(c=t,u=n,c>>>=0,i().subarray(c/1,c/1+u)).slice();return r.__wbindgen_free(t,1*n,1),a}finally{r.__wbindgen_add_to_stack_pointer(16)}var c,u}function b(e){return null==e}function w(e,t){try{return e.apply(this,t)}catch(e){r.__wbindgen_exn_store(l(e))}}async function v(t){if(void 0!==r)return r;void 0===t&&(t=new URL("passphoto_bg.wasm",e&&e.src||new URL("bundle.min.js",document.baseURI).href));const n=function(){const e={wbg:{}};return e.wbg.__wbindgen_error_new=function(e,t){return l(new Error(c(e,t)))},e.wbg.__wbindgen_object_drop_ref=function(e){f(e)},e.wbg.__wbg_instanceof_Window_f401953a2cf86220=function(e){let t;try{t=d(e)instanceof Window}catch(e){t=!1}return t},e.wbg.__wbg_document_5100775d18896c16=function(e){const t=d(e).document;return b(t)?0:l(t)},e.wbg.__wbg_getElementById_c369ff43f0db99cf=function(e,t,n){const r=d(e).getElementById(c(t,n));return b(r)?0:l(r)},e.wbg.__wbg_clientWidth_7ea3915573b64350=function(e){return d(e).clientWidth},e.wbg.__wbg_clientHeight_d24efa25aa66e844=function(e){return d(e).clientHeight},e.wbg.__wbg_getBoundingClientRect_91e6d57c4e65f745=function(e){return l(d(e).getBoundingClientRect())},e.wbg.__wbg_width_b455dec2a8f76e45=function(e){return d(e).width},e.wbg.__wbg_height_424ebb12c15f2691=function(e){return d(e).height},e.wbg.__wbg_instanceof_HtmlInputElement_307512fe1252c849=function(e){let t;try{t=d(e)instanceof HTMLInputElement}catch(e){t=!1}return t},e.wbg.__wbg_valueAsNumber_b6456a4b05234115=function(e){return d(e).valueAsNumber},e.wbg.__wbg_top_c4e2234a035a3d25=function(e){return d(e).top},e.wbg.__wbg_left_fe0a839abdd508f4=function(e){return d(e).left},e.wbg.__wbg_instanceof_HtmlImageElement_d823b10f99854a6b=function(e){let t;try{t=d(e)instanceof HTMLImageElement}catch(e){t=!1}return t},e.wbg.__wbg_naturalWidth_71b3dd9a08fc5b67=function(e){return d(e).naturalWidth},e.wbg.__wbg_naturalHeight_28222166431eb854=function(e){return d(e).naturalHeight},e.wbg.__wbg_newnoargs_e258087cd0daa0ea=function(e,t){return l(new Function(c(e,t)))},e.wbg.__wbg_call_27c0f87801dedf93=function(){return w((function(e,t){return l(d(e).call(d(t)))}),arguments)},e.wbg.__wbindgen_object_clone_ref=function(e){return l(d(e))},e.wbg.__wbg_self_ce0dbfc45cf2f5be=function(){return w((function(){return l(self.self)}),arguments)},e.wbg.__wbg_window_c6fb939a7f436783=function(){return w((function(){return l(window.window)}),arguments)},e.wbg.__wbg_globalThis_d1e6af4856ba331b=function(){return w((function(){return l(globalThis.globalThis)}),arguments)},e.wbg.__wbg_global_207b558942527489=function(){return w((function(){return l(global.global)}),arguments)},e.wbg.__wbindgen_is_undefined=function(e){return void 0===d(e)},e.wbg.__wbindgen_throw=function(e,t){throw new Error(c(e,t))},e}();("string"==typeof t||"function"==typeof Request&&t instanceof Request||"function"==typeof URL&&t instanceof URL)&&(t=fetch(t));const{instance:o,module:i}=await async function(e,t){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(e,t)}catch(t){if("application/wasm"==e.headers.get("Content-Type"))throw t;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t)}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}(await t,n);return function(e,t){return r=e.exports,v.__wbindgen_wasm_module=t,g=null,a=null,r}(o,i)}var y=function(){return y=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},y.apply(this,arguments)};function _(e,t){for(var n=e.length;n--;)if(e[n].pointerId===t.pointerId)return n;return-1}function E(e,t){var n;if(t.touches){n=0;for(var r=0,o=t.touches;r<o.length;r++){var a=o[r];a.pointerId=n++,E(e,a)}}else(n=_(e,t))>-1&&e.splice(n,1),e.push(t)}function x(e){for(var t,n=(e=e.slice(0)).pop();t=e.pop();)n={clientX:(t.clientX-n.clientX)/2+n.clientX,clientY:(t.clientY-n.clientY)/2+n.clientY};return n}function S(e){if(e.length<2)return 0;var t=e[0],n=e[1];return Math.sqrt(Math.pow(Math.abs(n.clientX-t.clientX),2)+Math.pow(Math.abs(n.clientY-t.clientY),2))}"undefined"!=typeof window&&(window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),"function"!=typeof window.CustomEvent&&(window.CustomEvent=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:null};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}));var L={down:"mousedown",move:"mousemove",up:"mouseup mouseleave"};function A(e,t,n,r){L[e].split(" ").forEach((function(e){t.addEventListener(e,n,r)}))}function I(e,t,n){L[e].split(" ").forEach((function(e){t.removeEventListener(e,n)}))}"undefined"!=typeof window&&("function"==typeof window.PointerEvent?L={down:"pointerdown",move:"pointermove",up:"pointerup pointerleave pointercancel"}:"function"==typeof window.TouchEvent&&(L={down:"touchstart",move:"touchmove",up:"touchend touchcancel"}));var B,M="undefined"!=typeof document&&!!document.documentMode;function k(){return B||(B=document.createElement("div").style)}var O=["webkit","moz","ms"],T={};function P(e){if(T[e])return T[e];var t=k();if(e in t)return T[e]=e;for(var n=e[0].toUpperCase()+e.slice(1),r=O.length;r--;){var o="".concat(O[r]).concat(n);if(o in t)return T[e]=o}}function W(e,t){return parseFloat(t[P(e)])||0}function z(e,t,n){void 0===n&&(n=window.getComputedStyle(e));var r="border"===t?"Width":"";return{left:W("".concat(t,"Left").concat(r),n),right:W("".concat(t,"Right").concat(r),n),top:W("".concat(t,"Top").concat(r),n),bottom:W("".concat(t,"Bottom").concat(r),n)}}function C(e,t,n){e.style[P(t)]=n}function R(e){var t=e.parentNode,n=window.getComputedStyle(e),r=window.getComputedStyle(t),o=e.getBoundingClientRect(),a=t.getBoundingClientRect();return{elem:{style:n,width:o.width,height:o.height,top:o.top,bottom:o.bottom,left:o.left,right:o.right,margin:z(e,"margin",n),border:z(e,"border",n)},parent:{style:r,width:a.width,height:a.height,top:a.top,bottom:a.bottom,left:a.left,right:a.right,padding:z(t,"padding",r),border:z(t,"border",r)}}}function X(e,t){return 1===e.nodeType&&" ".concat(function(e){return(e.getAttribute("class")||"").trim()}(e)," ").indexOf(" ".concat(t," "))>-1}var Y=/^http:[\w\.\/]+svg$/;var N={animate:!1,canvas:!1,cursor:"move",disablePan:!1,disableZoom:!1,disableXAxis:!1,disableYAxis:!1,duration:200,easing:"ease-in-out",exclude:[],excludeClass:"panzoom-exclude",handleStartEvent:function(e){e.preventDefault(),e.stopPropagation()},maxScale:4,minScale:.125,overflow:"hidden",panOnlyWhenZoomed:!1,pinchAndPan:!1,relative:!1,setTransform:function(e,t,n){var r=t.x,o=t.y,a=t.scale,i=t.isSVG;if(C(e,"transform","scale(".concat(a,") translate(").concat(r,"px, ").concat(o,"px)")),i&&M){var c=window.getComputedStyle(e).getPropertyValue("transform");e.setAttribute("transform",c)}},startX:0,startY:0,startScale:1,step:.3,touchAction:"none"};function U(e,t){if(!e)throw new Error("Panzoom requires an element as an argument");if(1!==e.nodeType)throw new Error("Panzoom requires an element with a nodeType of 1");if(!function(e){var t=e.ownerDocument,n=e.parentNode;return t&&n&&9===t.nodeType&&1===n.nodeType&&t.documentElement.contains(n)}(e))throw new Error("Panzoom should be called on elements that have been attached to the DOM");t=y(y({},N),t);var n=function(e){return Y.test(e.namespaceURI)&&"svg"!==e.nodeName.toLowerCase()}(e),r=e.parentNode;r.style.overflow=t.overflow,r.style.userSelect="none",r.style.touchAction=t.touchAction,(t.canvas?r:e).style.cursor=t.cursor,e.style.userSelect="none",e.style.touchAction=t.touchAction,C(e,"transformOrigin","string"==typeof t.origin?t.origin:n?"0 0":"50% 50%");var o,a,i,c,u,s,l=0,d=0,f=1,p=!1;function g(t,n,r){if(!r.silent){var o=new CustomEvent(t,{detail:n});e.dispatchEvent(o)}}function h(t,r,o){var a={x:l,y:d,scale:f,isSVG:n,originalEvent:o};return requestAnimationFrame((function(){"boolean"==typeof r.animate&&(r.animate?function(e,t){var n=P("transform");C(e,"transition","".concat(n," ").concat(t.duration,"ms ").concat(t.easing))}(e,r):C(e,"transition","none")),r.setTransform(e,a,r),g(t,a,r),g("panzoomchange",a,r)})),a}function m(n,r,o,a){var i=y(y({},t),a),c={x:l,y:d,opts:i};if(!i.force&&(i.disablePan||i.panOnlyWhenZoomed&&f===i.startScale))return c;if(n=parseFloat(n),r=parseFloat(r),i.disableXAxis||(c.x=(i.relative?l:0)+n),i.disableYAxis||(c.y=(i.relative?d:0)+r),i.contain){var u=R(e),s=u.elem.width/f,p=u.elem.height/f,g=s*o,h=p*o,m=(g-s)/2,b=(h-p)/2;if("inside"===i.contain){var w=(-u.elem.margin.left-u.parent.padding.left+m)/o,v=(u.parent.width-g-u.parent.padding.left-u.elem.margin.left-u.parent.border.left-u.parent.border.right+m)/o;c.x=Math.max(Math.min(c.x,v),w);var _=(-u.elem.margin.top-u.parent.padding.top+b)/o,E=(u.parent.height-h-u.parent.padding.top-u.elem.margin.top-u.parent.border.top-u.parent.border.bottom+b)/o;c.y=Math.max(Math.min(c.y,E),_)}else if("outside"===i.contain){w=(-(g-u.parent.width)-u.parent.padding.left-u.parent.border.left-u.parent.border.right+m)/o,v=(m-u.parent.padding.left)/o;c.x=Math.max(Math.min(c.x,v),w);_=(-(h-u.parent.height)-u.parent.padding.top-u.parent.border.top-u.parent.border.bottom+b)/o,E=(b-u.parent.padding.top)/o;c.y=Math.max(Math.min(c.y,E),_)}}return i.roundPixels&&(c.x=Math.round(c.x),c.y=Math.round(c.y)),c}function b(n,r){var o=y(y({},t),r),a={scale:f,opts:o};if(!o.force&&o.disableZoom)return a;var i=t.minScale,c=t.maxScale;if(o.contain){var u=R(e),s=u.elem.width/f,l=u.elem.height/f;if(s>1&&l>1){var d=(u.parent.width-u.parent.border.left-u.parent.border.right)/s,p=(u.parent.height-u.parent.border.top-u.parent.border.bottom)/l;"inside"===t.contain?c=Math.min(c,d,p):"outside"===t.contain&&(i=Math.max(i,d,p))}}return a.scale=Math.min(Math.max(n,i),c),a}function w(e,t,r,o){var a=m(e,t,f,r);return l!==a.x||d!==a.y?(l=a.x,d=a.y,h("panzoompan",a.opts,o)):{x:l,y:d,scale:f,isSVG:n,originalEvent:o}}function v(e,t,n){var r=b(e,t),o=r.opts;if(o.force||!o.disableZoom){e=r.scale;var a=l,i=d;if(o.focal){var c=o.focal;a=(c.x/e-c.x/f+l*e)/e,i=(c.y/e-c.y/f+d*e)/e}var u=m(a,i,e,{relative:!1,force:!0});return l=u.x,d=u.y,f=e,h("panzoomzoom",o,n)}}function B(e,n){var r=y(y(y({},t),{animate:!0}),n);return v(f*Math.exp((e?1:-1)*r.step),r)}function M(t,r,o,a){var i=R(e),c=i.parent.width-i.parent.padding.left-i.parent.padding.right-i.parent.border.left-i.parent.border.right,u=i.parent.height-i.parent.padding.top-i.parent.padding.bottom-i.parent.border.top-i.parent.border.bottom,s=r.clientX-i.parent.left-i.parent.padding.left-i.parent.border.left-i.elem.margin.left,l=r.clientY-i.parent.top-i.parent.padding.top-i.parent.border.top-i.elem.margin.top;n||(s-=i.elem.width/f/2,l-=i.elem.height/f/2);var d={x:s/c*(c*t),y:l/u*(u*t)};return v(t,y(y({},o),{animate:!1,focal:d}),a)}v(t.startScale,{animate:!1,force:!0}),setTimeout((function(){w(t.startX,t.startY,{animate:!1,force:!0})}));var k=[];function O(e){if(!function(e,t){for(var n=e;null!=n;n=n.parentNode)if(X(n,t.excludeClass)||t.exclude.indexOf(n)>-1)return!0;return!1}(e.target,t)){E(k,e),p=!0,t.handleStartEvent(e),o=l,a=d,g("panzoomstart",{x:l,y:d,scale:f,isSVG:n,originalEvent:e},t);var r=x(k);i=r.clientX,c=r.clientY,u=f,s=S(k)}}function T(e){if(p&&void 0!==o&&void 0!==a&&void 0!==i&&void 0!==c){E(k,e);var n=x(k),r=k.length>1,l=f;if(r)0===s&&(s=S(k)),M(l=b((S(k)-s)*t.step/80+u).scale,n,{animate:!1},e);r&&!t.pinchAndPan||w(o+(n.clientX-i)/l,a+(n.clientY-c)/l,{animate:!1},e)}}function W(e){1===k.length&&g("panzoomend",{x:l,y:d,scale:f,isSVG:n,originalEvent:e},t),function(e,t){if(t.touches)for(;e.length;)e.pop();else{var n=_(e,t);n>-1&&e.splice(n,1)}}(k,e),p&&(p=!1,o=a=i=c=void 0)}var z=!1;function U(){z||(z=!0,A("down",t.canvas?r:e,O),A("move",document,T,{passive:!0}),A("up",document,W,{passive:!0}))}return t.noBind||U(),{bind:U,destroy:function(){z=!1,I("down",t.canvas?r:e,O),I("move",document,T),I("up",document,W)},eventNames:L,getPan:function(){return{x:l,y:d}},getScale:function(){return f},getOptions:function(){return function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(t)},handleDown:O,handleMove:T,handleUp:W,pan:w,reset:function(e){var n=y(y(y({},t),{animate:!0,force:!0}),e);f=b(n.startScale,n).scale;var r=m(n.startX,n.startY,f,n);return l=r.x,d=r.y,h("panzoomreset",n)},resetStyle:function(){r.style.overflow="",r.style.userSelect="",r.style.touchAction="",r.style.cursor="",e.style.cursor="",e.style.userSelect="",e.style.touchAction="",C(e,"transformOrigin","")},setOptions:function(n){for(var o in void 0===n&&(n={}),n)n.hasOwnProperty(o)&&(t[o]=n[o]);(n.hasOwnProperty("cursor")||n.hasOwnProperty("canvas"))&&(r.style.cursor=e.style.cursor="",(t.canvas?r:e).style.cursor=t.cursor),n.hasOwnProperty("overflow")&&(r.style.overflow=n.overflow),n.hasOwnProperty("touchAction")&&(r.style.touchAction=n.touchAction,e.style.touchAction=n.touchAction)},setStyle:function(t,n){return C(e,t,n)},zoom:v,zoomIn:function(e){return B(!0,e)},zoomOut:function(e){return B(!1,e)},zoomToPoint:M,zoomWithWheel:function(e,n){e.preventDefault();var r=y(y(y({},t),n),{animate:!1}),o=(0===e.deltaY&&e.deltaX?e.deltaX:e.deltaY)<0?1:-1;return M(b(f*Math.exp(o*r.step/3),r).scale,e,r,e)}}}U.defaultOptions=N;var H=document.getElementById("cropper"),q=document.getElementById("zoom"),D=document.getElementById("chinline"),j=document.getElementById("img"),F=document.getElementById("download-btn"),G=document.getElementById("file"),V=document.getElementById("face-height-container"),Z=document.getElementById("chinline-toggle"),J=document.getElementById("mask-toggle"),$=document.getElementById("image-wrapper"),K=document.getElementById("kids-mask"),Q=U(H,{maxScale:10});q.addEventListener("input",(function(e){Q.zoom(e.target.valueAsNumber)})),D.addEventListener("input",(function(e){V.style.translate="0 ".concat(-e.target.valueAsNumber,"px")})),Z.addEventListener("input",(function(e){e.target.checked?(V.classList.add("hidden"),D.classList.add("hidden")):(V.classList.remove("hidden"),D.classList.remove("hidden"))})),J.addEventListener("input",(function(e){e.target.checked?$.style.backgroundSize="0 0":$.style.backgroundSize=""})),K.addEventListener("input",(function(e){e.target.checked?($.style.background="url(./assets/face-mask-kids.png)",V.style.background="url(./assets/face-height-kids.png)"):($.style.background="url(./assets/face-mask.png)",V.style.background="url(./assets/face-height.png)")}));var ee;document.getElementById("generate-button").addEventListener("click",(function(){oe.classList.remove("hidden"),q.value=Q.getScale(),setTimeout((function(){try{var e=m(new Int8Array(ee)),t=new Blob([e],{type:"image/png"}),n=URL.createObjectURL(t);j.src=n,F.href=n,F.download="passbilder.png",te.classList.add("hidden"),ne.classList.add("hidden"),re.classList.remove("hidden"),oe.classList.add("hidden")}catch(e){!function(e){oe.classList.add("hidden"),ae.querySelector("p").textContent=e instanceof Error?e.stack||e.message:e.toString(),ae.showModal();var t={error:e instanceof Error?e.stack||e.message:e.toString(),image:{clientWidth:H.clientWidth,clientHeight:H.clientHeight,naturalWidth:H.naturalWidth,naturalHeight:H.naturalHeight,translate:{x:0,y:0},scale:H.style.scale}};fetch("https://storage.hannaweb.eu/api/collections/passphoto_errors/records",{method:"POST",body:JSON.stringify({data:t}),headers:{"Content-Type":"application/json"}}).catch((function(e){console.error("Error reporting error",e)}))}(e)}}))})),G.addEventListener("change",(function(){var e=this.files[0],t=new FileReader;t.onload=function(e){ee=e.target.result;var t=new Blob([ee]);H.src=URL.createObjectURL(t),te.classList.add("hidden"),ne.classList.remove("hidden"),re.classList.add("hidden")},t.readAsArrayBuffer(e)}));var te=document.getElementById("select-view"),ne=document.getElementById("crop-view"),re=document.getElementById("result-view"),oe=document.getElementById("spinner"),ae=document.querySelector("dialog");for(var ie=0,ce=document.getElementsByClassName("restart");ie<ce.length;ie++){ce[ie].addEventListener("click",(function(){G.value=null,te.classList.remove("hidden"),ne.classList.add("hidden"),re.classList.add("hidden")}))}document.querySelector("#close-dialog").addEventListener("click",(function(){ae.close()})),function(){t(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return[4,v()];case 1:return e.sent(),[2]}}))}))}()}();
